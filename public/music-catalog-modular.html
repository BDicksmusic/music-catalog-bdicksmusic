<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Catalog - Brandon Dicks</title>
    <link rel="stylesheet" href="variables.css"> 
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="media-styles.css">
    
    <!-- ✨ TEMPLATE LOADER: Load modular navigation and footer -->
    <script src="/includes/template-loader.js"></script>
    
    <!-- ✨ COMPONENT LOADER: For potential media components -->
    <script src="/includes/component-loader.js"></script>
    
    <style>
        /* Music Catalog Specific Styles - CLEANED UP! */
        /* ✨ REMOVED: Global reset - now handled by styles.css */
        /* ✨ REMOVED: 50+ lines of duplicate navigation CSS */
        /* The navigation is now handled by the modular template! */

        body {
            padding-top: 95px; /* ✨ REDUCED: Account for compact navs (60px + 35px) */
        }

        /* Main Opening Section Styling */
        .main-opening {
            background: var(--gray-50);
            padding: 2rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--gray-200);
        }

        .main-opening-header {
            margin-bottom: 1rem;
        }

        .main-opening-header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .main-opening-content p {
            color: var(--gray-700);
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
        }

        .catalog-filters {
            background: transparent;
            padding: 0.75rem 1rem;
            margin: 0;
        }

        .filter-section {
            margin-bottom: 0;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .search-box {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .filter-tag {
            background: var(--primary-100);
            color: var(--primary-700);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-tag .remove {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.7;
        }

        .filter-tag .remove:hover {
            opacity: 1;
        }

        .filter-actions {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 1rem;
            align-items: center;
            margin-top: 0.25rem;
        }

        .filter-actions .btn {
            justify-self: start;
        }

        .sort-controls-inline {
            justify-self: end;
        }

        .sort-controls-inline {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sort-controls-inline .filter-select {
            min-width: 150px;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        /* ✨ FIXED: List-style layout matching original music-catalog.html */
        .catalog-results {
            padding: 1.5rem 1rem;
            overflow: hidden;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .results-count {
            color: var(--gray-600);
            font-size: 0.95rem;
        }

        .compositions-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin: 0 -0.1rem;
        }

        .composition-card {
            background: white;
            border-bottom: 1px solid var(--gray-150);
            padding: 0.75rem 0;
            margin: 0 -2rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: calc(100% + 4rem);
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .composition-card:hover {
            background-color: var(--gray-50);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            z-index: 1;
            position: relative;
        }

        .composition-card:first-child {
            border-top: 1px solid var(--gray-150);
        }

        .composition-main-info {
            display: flex;
            align-items: center;
            flex: 1;
            gap: 2.5rem;
            padding-left: 2rem;
        }

        .composition-title-section {
            flex: 2;
            min-width: 200px;
        }

        .composition-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 0.3rem;
            line-height: 1.3;
        }

        .composition-instrumentation {
            color: var(--gray-600);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .composition-details-section {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

        .composition-year {
            background: var(--primary-100);
            color: var(--primary-700);
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.3rem 0.8rem;
            border-radius: 14px;
            white-space: nowrap;
            flex-shrink: 0;
            border: 1px solid var(--primary-200);
        }

        .composition-duration {
            color: var(--gray-500);
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
            padding: 0.1rem 0;
        }

        .composition-meta {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .meta-tag {
            background: var(--gray-100);
            color: var(--gray-600);
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            white-space: nowrap;
        }

        .composition-actions {
            min-width: 120px;
            margin-left: 2.5rem;
            padding-right: 2rem;
            flex-shrink: 0;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            border-radius: 6px;
        }

        .composition-buy-btn {
            width: 100%;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            border-radius: 6px;
            background: var(--primary-500);
            color: white;
            border: none;
            cursor: pointer;
            text-decoration: none;
            display: block;
            text-align: center;
            transition: all 0.3s ease;
        }

        .composition-buy-btn:hover {
            background: var(--primary-600);
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--primary-500);
            color: white;
            border-color: var(--primary-500);
        }

        .btn-primary:hover {
            background: var(--primary-600);
            border-color: var(--primary-600);
        }

        .loading-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray-600);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--gray-700);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ✨ FIXED: Responsive design matching original */
        /* Tablet Responsive - 1080px breakpoint */
        @media (max-width: 1080px) {
            .filter-row {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr 1fr;
                grid-template-rows: auto auto;
                gap: 0.75rem;
            }

            /* Search goes to top row, spans 2 columns */
            .filter-section:nth-child(1) {
                grid-column: 1 / 3;
                order: 1;
            }
            
            /* Other filters follow in order */
            .filter-section:nth-child(2) {
                order: 2;
            }
            
            .filter-section:nth-child(3) {
                order: 3;
            }
            
            .filter-section:nth-child(4) {
                order: 4;
            }
            
            .filter-section:nth-child(5) {
                order: 5;
            }

            .filter-actions {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr 1fr;
                gap: 0.75rem;
                align-items: center;
                margin-top: 0.25rem;
            }

            .filter-actions .btn {
                grid-column: 1 / 3;
                justify-self: start;
            }

            .sort-controls-inline {
                grid-column: 3 / 5;
                justify-self: end;
            }
        }

        /* Mobile Responsive - 768px breakpoint */
        @media (max-width: 768px) {
            .main-opening {
                padding: 1.5rem 0.75rem;
            }
            
            .main-opening-header h1 {
                font-size: 1.5rem;
            }

            .main-opening-content p {
                font-size: 0.85rem;
            }
            
            .catalog-filters {
                padding: 0.75rem 1rem;
                margin: 0;
            }

            .filter-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto auto;
                gap: 0.75rem;
            }

            /* Search spans full width on top row */
            .filter-section:nth-child(1) {
                grid-column: 1 / 3;
                order: 1;
            }
            
            /* Two filters per row for remaining filters */
            .filter-section:nth-child(2) {
                order: 2;
            }
            
            .filter-section:nth-child(3) {
                order: 3;
            }
            
            .filter-section:nth-child(4) {
                order: 4;
            }
            
            .filter-section:nth-child(5) {
                order: 5;
            }

            .filter-actions {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
                align-items: center;
                grid-column: 1 / 3;
            }

            .filter-actions .btn {
                justify-self: start;
            }

            .sort-controls-inline {
                justify-self: end;
            }

            .catalog-results {
                padding: 1.25rem 0.75rem;
            }

            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .composition-card {
                flex-direction: column;
                align-items: flex-start;
                padding: 0.75rem 0;
                margin: 0 -1rem;
                width: calc(100% + 2rem);
            }

            .composition-main-info {
                flex-direction: column;
                gap: 1.25rem;
                width: 100%;
                margin-bottom: 1.25rem;
                padding-left: 1rem;
            }

            .composition-details-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
                width: 100%;
            }

            .composition-actions {
                margin-left: 0;
                width: 100%;
                min-width: unset;
                padding-right: 1rem;
                margin-top: 0.5rem;
            }

            .composition-meta {
                margin-top: 0.5rem;
            }

                         body {
                 padding-top: 92px; /* ✨ REDUCED: Adjust for compact mobile nav (60px + 32px) */
             }
        }

    </style>
</head>
<body>
    <!-- ✨ REMOVED: 65+ lines of navigation HTML -->
    <!-- Navigation will be automatically injected by template-loader.js -->

    <!-- Main Opening Section -->
    <section class="main-opening">
        <div class="main-opening-header">
            <h1>Music Catalog</h1>
        </div>
        <div class="main-opening-content">
            <p>This part of the website includes the full catalog of compositions created by Brandon Dicks. You can learn more about each composition by clicking the name of the work. There is a specific page for each work that includes a perusal score, example parts [if applicable], audio example, and download links for those compositions that are available. <strong>Every composition is available for purchase.</strong> If a work is not available for download, you can contact Brandon directly to get a quote for the piece and get your own copy of the composition. Compositions are also available in physical form if requested by the ensemble/individual.</p>
        </div>
    </section>
    
    <!-- Filtering System -->
    <section class="catalog-filters">
        <div class="filter-row">
            <div class="filter-section">
                <input type="text" id="search" class="search-box" placeholder="Search by title, instrumentation, or keywords...">
            </div>

            <div class="filter-section">
                <select id="category" class="filter-select">
                    <option value="">All Categories</option>
                    <option value="compositions">Original Compositions</option>
                    <option value="arrangements">Arrangements</option>
                </select>
            </div>

            <div class="filter-section">
                <select id="ensemble-type" class="filter-select">
                    <option value="">All Ensemble Types</option>
                    <option value="solo">Solo Works</option>
                    <option value="chamber">Chamber Ensemble</option>
                    <option value="large-ensemble">Large Ensemble</option>
                    <option value="brass">Brass Ensemble</option>
                    <option value="wind">Wind Ensemble</option>
                </select>
            </div>

            <div class="filter-section">
                <select id="instrumentation" class="filter-select">
                    <option value="">All Instrumentations</option>
                    <option value="trumpet">Trumpet</option>
                    <option value="brass-quartet">Brass Quartet</option>
                    <option value="brass-quintet">Brass Quintet</option>
                    <option value="brass-trio">Brass Trio</option>
                    <option value="wind-ensemble">Wind Ensemble</option>
                    <option value="piano">With Piano</option>
                </select>
            </div>

            <div class="filter-section">
                <select id="difficulty" class="filter-select">
                    <option value="">Any Difficulty</option>
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                    <option value="professional">Professional</option>
                </select>
            </div>
        </div>

        <div class="filter-tags" id="active-filters"></div>

        <div class="filter-actions">
            <button class="btn btn-secondary" id="clear-filters">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Clear All
            </button>
            <div class="sort-controls-inline">
                <select id="sort-by-inline" class="filter-select">
                    <option value="smart" selected>Sort: Smart (Featured → Original → Ensemble)</option>
                    <option value="title">Sort: Title A-Z</option>
                    <option value="title-desc">Sort: Title Z-A</option>
                    <option value="year">Sort: Year (Newest)</option>
                    <option value="year-desc">Sort: Year (Oldest)</option>
                    <option value="duration">Sort: Duration (Shortest)</option>
                    <option value="duration-desc">Sort: Duration (Longest)</option>
                </select>
            </div>
        </div>
    </section>

    <!-- ✨ FIXED: Results Section matching original structure -->
    <section class="catalog-results">
        <div class="results-header">
            <div class="results-count" id="results-count">Loading compositions...</div>
        </div>

        <!-- Loading State -->
        <div class="loading-state" id="loading-state">
            <div class="spinner"></div>
            <p>Loading compositions from the catalog...</p>
        </div>

        <!-- Compositions Grid -->
        <div class="compositions-grid" id="compositions-grid" style="display: none;">
            <!-- ✨ EXAMPLE: List-style composition cards -->
            <a href="/composition/resolutions-suite" class="composition-card" data-composition="resolutions-suite">
                <div class="composition-main-info">
                    <div class="composition-title-section">
                        <h3 class="composition-title">Resolutions Suite for Brass Trio</h3>
                        <div class="composition-instrumentation">Brass Trio (2 Trumpets, Trombone)</div>
                    </div>
                    
                    <div class="composition-details-section">
                        <div class="composition-year">2023</div>
                        <div class="composition-duration">8 min</div>
                        <div class="composition-meta">
                            <span class="meta-tag">Original</span>
                            <span class="meta-tag">Advanced</span>
                        </div>
                    </div>
                </div>
                
                <div class="composition-actions">
                    <button class="composition-buy-btn" onclick="event.preventDefault(); event.stopPropagation(); window.open('#', '_blank')">Buy Now</button>
                </div>
            </a>

            <a href="/composition/trumpet-concerto" class="composition-card" data-composition="trumpet-concerto">
                <div class="composition-main-info">
                    <div class="composition-title-section">
                        <h3 class="composition-title">Trumpet Concerto in B♭</h3>
                        <div class="composition-instrumentation">Solo Trumpet with Orchestra</div>
                    </div>
                    
                    <div class="composition-details-section">
                        <div class="composition-year">2022</div>
                        <div class="composition-duration">15 min</div>
                        <div class="composition-meta">
                            <span class="meta-tag">Original</span>
                            <span class="meta-tag">Professional</span>
                        </div>
                    </div>
                </div>
                
                <div class="composition-actions">
                    <button class="composition-buy-btn" onclick="event.preventDefault(); event.stopPropagation(); window.open('#', '_blank')">Buy Now</button>
                </div>
            </a>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="empty-state" style="display: none;">
            <h3>No compositions found</h3>
            <p>Try adjusting your filters to see more results, or <a href="#" id="clear-filters-link">clear all filters</a> to view the complete catalog.</p>
        </div>
    </section>

    <!-- ✨ ADDED: Footer will be automatically injected by template-loader.js -->

    <script>
        // ✨ WAIT FOR CSS TO LOAD COMPLETELY
        function waitForCSS() {
            return new Promise((resolve) => {
                // Check if the main-footer class exists (meaning CSS is loaded)
                const testElement = document.createElement('div');
                testElement.className = 'main-footer';
                testElement.style.visibility = 'hidden';
                testElement.style.position = 'absolute';
                document.body.appendChild(testElement);
                
                const checkCSS = () => {
                    const styles = window.getComputedStyle(testElement);
                    if (styles.background !== 'rgba(0, 0, 0, 0)' && styles.background !== 'transparent') {
                        console.log('✅ CSS loaded successfully');
                        document.body.removeChild(testElement);
                        resolve();
                    } else {
                        console.log('⏳ Waiting for CSS...');
                        setTimeout(checkCSS, 50);
                    }
                };
                
                setTimeout(checkCSS, 100);
            });
        }

                 // ✨ INITIALIZE MODULAR TEMPLATES WITH SMOOTH LOADING
         document.addEventListener('DOMContentLoaded', async () => {
             console.log('🚀 Loading modular templates with smooth loading...');
             
             try {
                 // ✨ WAIT FOR CSS TO LOAD FIRST
                 await waitForCSS();
                 
                 // ✨ Load templates with smooth loading system
                 await TemplateLoader.loadAllTemplates();
                 
                 // ✨ SHOW SAMPLE COMPOSITIONS AFTER SMOOTH LOADING
                 console.log('🎵 Displaying sample compositions...');
                 document.getElementById('compositions-grid').style.display = 'flex';
                 document.getElementById('results-count').textContent = 'Showing 2 sample compositions';
                 
                 console.log('✅ All templates loaded smoothly!');
                 
             } catch (error) {
                 console.error('❌ Template loading failed:', error);
                 
                 // Fallback: show content even if templates fail
                 document.getElementById('compositions-grid').style.display = 'flex';
                 document.getElementById('results-count').textContent = 'Showing 2 sample compositions';
             }
         });

        // ✨ SIMPLIFIED: Theme toggle is now handled by template-loader.js
        // ✨ REMOVED: Manual navigation JavaScript - now handled by templates

        // Your existing composition filtering and loading logic
        // (Keep all your existing JavaScript for filtering, searching, etc.)
        const compositionsGrid = document.getElementById('compositions-grid');
        const loadingState = document.getElementById('loading-state');
        const emptyState = document.getElementById('empty-state');
        
        // Sample data - your existing composition data loading logic goes here
        const compositions = [
            // Your existing compositions array
        ];

        function renderCompositions(compositions) {
            compositionsGrid.innerHTML = '';
            
            compositions.forEach(composition => {
                const card = createCompositionCard(composition);
                compositionsGrid.appendChild(card);
            });
        }

        function createCompositionCard(composition) {
            // ✨ FIXED: List-style card creation matching original
            const card = document.createElement('a');
            card.className = 'composition-card';
            card.href = `/composition/${composition.slug}`;
            card.setAttribute('data-composition', composition.id);
            
            // Handle duration - don't add "min" if it's already there
            let durationText = 'Duration not specified';
            if (composition.duration) {
                const duration = composition.duration.toString();
                durationText = duration.includes('min') ? duration : `${duration} min`;
            }
            
            // Only show year if it exists
            const yearElement = composition.year ? `<div class="composition-year">${composition.year}</div>` : '';
            
            card.innerHTML = `
                <div class="composition-main-info">
                    <div class="composition-title-section">
                        <h3 class="composition-title">${composition.title}</h3>
                        <div class="composition-instrumentation">${composition.instrumentation}</div>
                    </div>
                    
                    <div class="composition-details-section">
                        ${yearElement}
                        <div class="composition-duration">${durationText}</div>
                        <div class="composition-meta">
                            ${composition.type ? `<span class="meta-tag">${composition.type}</span>` : ''}
                            ${composition.difficulty ? `<span class="meta-tag">${composition.difficulty}</span>` : ''}
                        </div>
                    </div>
                </div>
                
                <div class="composition-actions">
                    <button class="composition-buy-btn" onclick="event.preventDefault(); event.stopPropagation(); window.open('${composition.purchaseUrl || '#'}', '_blank')">Buy Now</button>
                </div>
            `;

            return card;
        }

        // Your existing filtering, searching, and sorting logic remains the same
        function filterCompositions() {
            // Keep your existing filter logic
        }

        function searchCompositions() {
            // Keep your existing search logic
        }

        function sortCompositions() {
            // Keep your existing sort logic  
        }

        function showLoadingState() {
            loadingState.style.display = 'block';
            compositionsGrid.style.display = 'none';
            emptyState.style.display = 'none';
        }

        function hideLoadingState() {
            loadingState.style.display = 'none';
        }

        function showEmptyState() {
            emptyState.style.display = 'block';
            compositionsGrid.style.display = 'none';
        }

        function hideEmptyState() {
            emptyState.style.display = 'none';
        }

        // Debounce helper function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html> 